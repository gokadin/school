@layout('school.layout')

@inject('\Library\Http\Form')

@section('content')

<div class="main-title">
    Students
</div>

<div class="content-padding">
    @if ($user->settings()->showTips())
        <info-box>
            <p>
                We will send an invitation email once you add the new student,
                who will then complete a form to register to your school.
            </p>
            <a href="@path('school.teacher.setting.registrationForm')">Customize your form</a>
        </info-box>
    @endif

    <div class="panel-1">
        {!! $form->open('school.teacher.student.preRegister', 'POST', ['id' => 'create-student-form', 'class' => 'form-1']) !!}

        <div class="form-title">
            Add a new student
        </div>

        <div class="form-row">
            {!! $form->label('firstName', 'First name') !!}
            {!! $form->text('firstName', null, ['placeholder' => 'First name (optional)']) !!}
            {!! $form->error('firstName') !!}
        </div>

        <div class="form-row">
            {!! $form->label('lastName', 'Last name') !!}
            {!! $form->text('lastName', null, ['placeholder' => 'Last name (optional)']) !!}
            {!! $form->error('lastName') !!}
        </div>

        <div class="form-row">
            {!! $form->label('email', 'Email') !!}
            {!! $form->text('email', null, ['placeholder' => 'Email']) !!}
            {!! $form->error('email') !!}
        </div>

        <div class="form-row">
            {!! $form->label('activity', 'Activity') !!}
            <search-select name="activityId"
                           :data="{{ $activities }}"
                           value="id"
                           display="name"
                           placeholder="Select an activity"
            >
            </search-select>
        </div>

        <div class="form-row">
            {!! $form->label('customPrice', 'Custom price') !!}
            {!! $form->text('customPrice', null, ['placeholder' => 'Custom price']) !!}
            {!! $form->error('customPrice') !!}
        </div>

        <div class="form-buttons">
            <label for="create-another">
                <input type="checkbox" id="create-another" name="createAnother" value="1" />
                Add another
            </label>

            {!! $form->submit('Send invitation') !!}
        </div>

        {!! $form->close() !!}
    </div>
</div>

@stop()

@section('javascript')

<script type="text/javascript">
    var activities = JSON.parse('{!! $activities !!}');

    $('#create-student-form').validate({
        email: [
            {rule: 'required', message: 'email is required'},
            {rule: 'email', message: 'must be a valid email'}
        ],
        customPrice: [
            {rule: 'numeric', message: 'must be a valid number'}
        ]
    });

    $(function() {
        if (activities.length == 0) {
            return;
        }

        $('#customPrice').val(activities[0].rate);
    });

    $('select[name="activityId"]').change(function() {
        var id = $('select[name="activityId"]').val();

        var rate = 0;
        for (var i = 0; i < activities.length; i++) {
            if (activities[i].id == id) {
                rate = activities[i].rate;
                
                break;
            }
        }

        $('#customPrice').val(rate);
    });
</script>

@stop()