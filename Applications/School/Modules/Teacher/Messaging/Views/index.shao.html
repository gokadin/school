@inject('\Library\Facades\Form')

<div>
    <div id="demo">
        {{ Form::open('', 'POST', ['v-on' => 'submit: submitForm'], false) }}

        <div class="form-row">
            {{ Form::text('content', null, ['v-model' => 'newMessage.content']) }}
            <select id="student-ids" class="js-example-basic-multiple form-control" multiple="multiple">
                @foreach ($students as $student)
                <option value="{{ $student->id }}" data-picture="{{ $student->profile_picture }}">{{ $student->name() }}</option>
                @endforeach
            </select>
        </div>

        <div class="form-row">
            {{ Form::button('Send', ['type' => 'submit']) }}
        </div>

        {{ Form::close() }}

        <!--<div class="col-md-12 user-row" v-repeat="userMessage: userMessages">
            <img src="@{{ userMessage.profile_picture }}" width="50" height="auto" />
            <a href="javascript:;" v-on="click: showMessages(this)">@{{ userMessage.name }}</a>
        </div>-->
    </div>
</div>

<link rel="stylesheet" type="text/css" href="/Web/css/select2.min.css">
<script type="text/javascript" src="/Web/js/select2.min.js"></script>

<script type="text/javascript">
    $('#student-ids').select2({
        placeholder: "Select students",
        templateResult: formatStudent
    });

    function formatStudent (student) {
        var $student = $(
                '<span><img src="' + $(student.element).data("picture") + '" width="20" /> ' + student.text + '</span>'
        );
        return $student;
    }

    new Vue({
        el: '#demo',

        data: {
            newMessage: {
                content: '',
                to_id: '',
                to_type: ''
            },

            userMessages: JSON.parse('{{ $userMessagesJson }}')
        },

        methods: {
            submitForm: function(e) {
                e.preventDefault();

                var message = this.newMessage;
                message.to_id = $('#student-ids').select2('val')[0];
                message.to_type = 'Student';
                this.newMessage = {content: '', to_id: '', to_type: ''};

                this.$http.post('/school/teacher/messaging/ajax/store', message);
            }
        }
    });
</script>