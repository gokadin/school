<form id="subscription-credit-card-form" action="@path('School#Teacher/Account#processCreditCardPayment')" method="POST">
    <div class="create-form-body">

        <span class="payment-errors"></span>

        <input type="hidden" value="{{ $subscription->type }}" />

        <div class="row create-form-input-row subscription-description-row">
            <div class="col-md-3 create-form-label"><b>Subscription</b></div>
            <div class="col-md-9">{{ $subscription->name().'&nbsp;&nbsp;&nbsp;'.$subscription->defaultRate().' / month' }}</div>
        </div>

        <div class="row create-form-input-row">
            <div class="col-md-3 create-form-label">Card number<span class="required">*</span></div>
            <div class="col-md-9 create-form-input">
                <div class="input-icon">
                    <i class="fa fa-warning"></i>
                    <input type="text" class="form-control" id="cardNumber" data-stripe="number" placeholder="Card Number" />
                </div>
                <span class="input-message">Card number is required.</span>
                <span class="input-message">Must be numeric.</span>
            </div>
        </div>

        <div class="row create-form-input-row">
            <div class="col-md-3 create-form-label">Expires<span class="required">*</span></div>
            <div class="col-md-9 create-form-input">
                <select id="expirationMonth" class="form-control" data-stripe="exp-month">
                    <option value="0">---</option>
                    @for ($i = 1; $i < 13; $i++)
                        @if ($i < 10)
                            <option value="0{{ $i }}">0{{ $i }}</option>
                        @else
                            <option value="{{ $i }}">{{ $i }}</option>       
                        @endif
                    @endfor
                </select>
                <select id="expirationYear" class="form-control" data-stripe="exp-year">
                    <option value="0">---</option>
                    @for ($i = 15; $i < 46; $i++)
                        <option value="20{{ $i }}">20{{ $i }}</option>
                    @endfor
                </select>
            </div>
        </div>

        <div class="row create-form-input-row">
            <div class="col-md-3 create-form-label">Card code<span class="required">*</span></div>
            <div class="col-md-3 create-form-input">
                <div class="input-icon">
                    <i class="fa fa-warning"></i>
                    <input type="text" class="form-control" id="cardCode" data-stripe="cvc" placeholder="CVC" />
                </div>
                <span class="input-message">Card code is required.</span>
                <span class="input-message">Must be numeric.</span>
                <span class="input-message">Must be 3 digits long.</span>
            </div>
        </div>

    </div>
    <div class="create-form-footer">
        <div class="col-md-7"></div>
        <div class="col-md-5">
            <a href="@path('School#Teacher/Account#subscription')"><button id="credit-card-payment-cancel-button" class="btn btn-default" type="button">Cancel</button></a>
            <button id="credit-card-payment-submit-button" class="btn btn-success" type="submit">Subscribe</button>
        </div>
    </div>
</form>



<script type="text/javascript" src="https://js.stripe.com/v2/"></script>
<script type="text/javascript">
Stripe.setPublishableKey('pk_test_TYrTrbmk26Ycou9fkd7U81Ol');

jQuery(function($) {
  $('#subscription-credit-card-form').submit(function(event) {
    var $form = $(this);

    $('#credit-card-payment-submit-button').prop('disabled', true);

    Stripe.card.createToken($form, stripeResponseHandler);

    return false;
  });
});

function stripeResponseHandler(status, response) {
  var $form = $('#subscription-credit-card-form');

  if (response.error) {
    $form.find('.payment-errors').text(response.error.message);
    $('#credit-card-payment-submit-button').prop('disabled', false);
  } else {
    var token = response.id;
    $form.append($('<input type="hidden" name="stripeToken" />').val(token));
    $form.get(0).submit();
  }
};
</script>

<script type="text/javascript" src="/School/Applications/School/Modules/Teacher/Account/Views/js/validateCreditCardPayment.js"></script>